version: '3.8'

services:
  web:
    # 1. Указываем Docker собирать образ из Dockerfile в текущей директории
    build: .

    # 2. Всегда перезапускать контейнер в случае сбоя или перезагрузки ВМ
    restart: always

    # 3. Проброс портов: <порт_на_ВМ>:<порт_в_контейнере>
    # Ваше приложение будет доступно на порту 5015 вашей ВМ
    ports:
      - "5015:5015"

    # 4. Монтирование тома (volume) для постоянных данных
    # Это связывает папку './data' на ВМ с папкой '/app/data' в контейнере
    # ВАЖНО: Ваша база данных (app.db), загрузки, словари и т.д. будут храниться здесь
    volumes:
      - ./data:/app/data

    # 5. Переменные окружения
    # ОБЯЗАТЕЛЬНО замените 'your_production_secret_key_here' на ваш настоящий ключ
    environment:
      - SECRET_KEY=your_production_secret_key_here
      # DATABASE_URL можно не указывать, config.py по умолчанию
      # будет использовать 'sqlite:////app/data/app.db' (внутри контейнера)